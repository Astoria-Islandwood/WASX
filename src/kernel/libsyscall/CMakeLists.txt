project(libsyscall)

cmake_minimum_required(VERSION 2.4.0)

enable_language(C ASM)

set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -std=c99 -nostdinc -include ${CMAKE_CURRENT_SOURCE_DIR}/nolegacy.h")
include_directories("${CMAKE_CURRENT_SOURCE_DIR}/wrappers")
include_directories("${CMAKE_CURRENT_SOURCE_DIR}/mach")
include_directories("${CMAKE_CURRENT_SOURCE_DIR}/../iokit")
include_directories("${CMAKE_CURRENT_SOURCE_DIR}/os")
include_directories("${CMAKE_SOURCE_DIR}/platform-include")
include_directories("${CMAKE_SOURCE_DIR}/kernel-include/libkern/libkern")
include_directories("${CMAKE_CURRENT_SOURCE_DIR}/../../libc/include")
include_directories("${CMAKE_CURRENT_SOURCE_DIR}/../../duct/include")
include_directories("${CMAKE_CURRENT_SOURCE_DIR}/wrappers/libproc")
include_directories("${CMAKE_CURRENT_SOURCE_DIR}/wrappers/spawn")
include_directories("${CMAKE_CURRENT_BINARY_DIR}")
add_definitions(-DPRIVATE=1 -D__DARWIN_C_LEVEL=20150101)
add_definitions('-D__XNU_PRIVATE_EXTERN=')
add_definitions(-DIOKIT_ALL_IPC=1 -DIOKIT=1)
#add_definitions(-DKERNEL)

include_directories(${CMAKE_SOURCE_DIR}/src/external/lkm/osfmk)
set(MIG_USER_HEADER_SUFFIX "_internal.h")
mig(mach/host_priv.defs)
mig(mach/host_security.defs)
mig(mach/ledger.defs)
mig(mach/lock_set.defs)
mig(mach/mach_host.defs)
mig(mach/mach_port.defs)
mig(mach/mach_vm.defs)
mig(mach/mach_voucher.defs)
mig(mach/notify.defs)
mig(mach/processor_set.defs)
mig(mach/processor.defs)
mig(mach/task.defs)
mig(mach/thread_act.defs)
mig(mach/vm_map.defs)
mig(mach/exc.defs)
mig(device/device.defs)

set(syscall_legacy_sources
	wrappers/legacy/accept.c
	wrappers/legacy/bind.c
	wrappers/legacy/connect.c
	wrappers/legacy/getattrlist.c
	wrappers/legacy/getaudit.c
	wrappers/legacy/getpeername.c
	wrappers/legacy/getsockname.c
	wrappers/legacy/kill.c
	wrappers/legacy/lchown.c
	wrappers/legacy/listen.c
	wrappers/legacy/mprotect.c
	wrappers/legacy/msync.c
	wrappers/legacy/munmap.c
	wrappers/legacy/open.c
	wrappers/legacy/recvfrom.c
	wrappers/legacy/recvmsg.c
	wrappers/legacy/select.c
	#wrappers/legacy/select-pre1050.c
	wrappers/legacy/sendmsg.c
	wrappers/legacy/sendto.c
	wrappers/legacy/setattrlist.c
	wrappers/legacy/sigsuspend.c
	wrappers/legacy/socketpair.c
	)

set(syscall_dynamic_sources
	wrappers/_libc_funcptr.c
	wrappers/_libkernel_init.c)

set(syscall_sources
	mach/mach_traps.S
	os/alloc_once.c
	wrappers/libproc/libproc.c
	wrappers/libproc/proc_listpidspath.c

	wrappers/mach_approximate_time_i386.S
	wrappers/carbon_delete.c
	wrappers/clonefile.c
	wrappers/coalition.c
	wrappers/__commpage_gettimeofday.c
	wrappers/__commpage_gettimeofday_asm.S
	wrappers/__get_cpu_capabilities.S
	wrappers/csr.c
	wrappers/fs_snapshot.c
	wrappers/gethostuuid.c
	wrappers/getiopolicy_np.c
	wrappers/guarded_open_dprotected_np.c
	wrappers/guarded_open_np.c
	wrappers/init_cpu_capabilities.c
	wrappers/ioctl.c
	wrappers/kdebug_trace.c
	wrappers/kill.c
	wrappers/mach_approximate_time.c
	wrappers/mach_boottime.c
	wrappers/mach_continuous_time.c
	wrappers/mach_get_times.c
	wrappers/mach_timebase_info.c
	wrappers/open_dprotected_np.c
	wrappers/persona.c
	wrappers/posix_sem_obsolete.c
	wrappers/quota_obsolete.c
	wrappers/remove-counter.c
	wrappers/renameat.c
	wrappers/rename.c
	wrappers/renamex.c
	wrappers/rmdir.c
	wrappers/setpriority.c
	wrappers/sfi.c
	wrappers/stackshot.c
	wrappers/terminate_with_reason.c
	wrappers/thread_register_state.c
	wrappers/unlinkat.c
	wrappers/unlink.c
	wrappers/work_interval.c
	wrappers/utimensat.c

	wrappers/legacy/select-pre1050.c
	
	wrappers/cancelable/fcntl.c
	wrappers/cancelable/fcntl-cancel.c
	wrappers/cancelable/select.c # defined in sys_x86-64/
	wrappers/cancelable/select-cancel.c
	wrappers/cancelable/sigsuspend.c
	wrappers/cancelable/sigsuspend-cancel.c
	wrappers/cancelable/pselect-darwinext-cancel.c
	wrappers/cancelable/pselect-darwinext.c
	
	wrappers/unix03/chmod.c
	wrappers/unix03/fchmod.c
	wrappers/unix03/getrlimit.c
	wrappers/unix03/mmap.c
	wrappers/unix03/munmap.c
	wrappers/unix03/setrlimit.c

	wrappers/spawn/posix_spawn.c
	
	${syscall_legacy_sources}

	custom/errno.c
	
	# MIG generated files
	${CMAKE_CURRENT_BINARY_DIR}/mach/host_privUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/host_securityUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/ledgerUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/lock_setUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/mach_hostUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/mach_portUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/mach_vmUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/mach_voucherUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/notifyUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/processor_setUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/processorUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/taskUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/thread_actUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/vm_mapUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/clockUser.c
	${CMAKE_CURRENT_BINARY_DIR}/device/deviceUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/excServer.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/excUser.c
	
	mach/mach_init.c
	mach/clock_sleep.c
	mach/dylib_link.c
	mach/error_codes.c
	mach/exc_catcher.c
	mach/exc_catcher_state.c
	mach/exc_catcher_state_identity.c
	mach/fprintf_stderr.c
	mach/mach_error.c
	mach/mach_error_string.c
	mach/mach_init.c
	mach/mach_legacy.c
	mach/mach_msg.c
	mach/mach_port.c
	mach/mach_vm.c
	mach/mig_allocate.c
	mach/mig_deallocate.c
	mach/mig_reply_port.c
	mach/mig_reply_setup.c
	mach/mig_strncpy.c
	mach/ms_thread_switch.c
	mach/panic.c
	mach/port_obj.c
	mach/semaphore.c
	mach/slot_name.c
	mach/string.c
	mach/thread_act.c

	bsdsyscalls/___abort_with_payload.s
	bsdsyscalls/___accept_nocancel.s
	bsdsyscalls/___accept.s
	bsdsyscalls/___access_extended.s
	bsdsyscalls/_access.s
	bsdsyscalls/_acct.s
	bsdsyscalls/_adjtime.s
	bsdsyscalls/_aio_cancel.s
	bsdsyscalls/_aio_error.s
	bsdsyscalls/_aio_fsync.s
	bsdsyscalls/_aio_read.s
	bsdsyscalls/_aio_return.s
	bsdsyscalls/___aio_suspend_nocancel.s
	bsdsyscalls/_aio_suspend.s
	bsdsyscalls/_aio_write.s
	bsdsyscalls/_auditctl.s
	bsdsyscalls/_auditon.s
	bsdsyscalls/_audit.s
	bsdsyscalls/_audit_session_join.s
	bsdsyscalls/_audit_session_port.s
	bsdsyscalls/_audit_session_self.s
	bsdsyscalls/___bind.s
	bsdsyscalls/___bsdthread_create.s
	bsdsyscalls/___bsdthread_ctl.s
	bsdsyscalls/___bsdthread_register.s
	bsdsyscalls/___bsdthread_terminate.s
	bsdsyscalls/_clonefileat.s
	bsdsyscalls/___close_nocancel.s
	bsdsyscalls/_close.s
	bsdsyscalls/___coalition_info.s
	bsdsyscalls/___coalition.s
	bsdsyscalls/___connect_nocancel.s
	bsdsyscalls/___connect.s
	bsdsyscalls/_connectx.s
	bsdsyscalls/___copyfile.s
	bsdsyscalls/_csops_audittoken.s
	bsdsyscalls/_csops.s
	bsdsyscalls/___csrctl.s
	bsdsyscalls/custom.s
	bsdsyscalls/___delete.s
	bsdsyscalls/___disable_threadsignal.s
	bsdsyscalls/_disconnectx.s
	bsdsyscalls/_dup.s
	bsdsyscalls/_dup2.s
	bsdsyscalls/_execve.s
	bsdsyscalls/_exchangedata.s
	bsdsyscalls/___exit.s
	bsdsyscalls/_faccessat.s
	bsdsyscalls/_fclonefileat.s
	bsdsyscalls/___fcntl_nocancel.s
	bsdsyscalls/___fcntl.s
	bsdsyscalls/_fdatasync.s
	bsdsyscalls/_ffsctl.s
	bsdsyscalls/_fgetattrlist.s
	bsdsyscalls/_fgetxattr.s
	bsdsyscalls/_fhopen.s
	bsdsyscalls/_fchdir.s
	bsdsyscalls/_fchflags.s
	bsdsyscalls/_fchmodat.s
	bsdsyscalls/___fchmod_extended.s
	bsdsyscalls/___fchmod.s
	bsdsyscalls/_fchownat.s
	bsdsyscalls/_fchown.s
	bsdsyscalls/_fileport_makefd.s
	bsdsyscalls/_fileport_makeport.s
	bsdsyscalls/_flistxattr.s
	bsdsyscalls/_flock.s
	bsdsyscalls/___fork.s
	bsdsyscalls/_fpathconf.s
	bsdsyscalls/_fremovexattr.s
	bsdsyscalls/_fsctl.s
	bsdsyscalls/_fsetattrlist.s
	bsdsyscalls/_setattrlistat.s
	bsdsyscalls/_fsetxattr.s
	bsdsyscalls/_fsgetpath.s
	bsdsyscalls/___fsgetpath.s
	bsdsyscalls/___fs_snapshot.s
	bsdsyscalls/_fstatat.s
	bsdsyscalls/_fstatat64.s
	bsdsyscalls/___fstat_extended.s
	bsdsyscalls/_fstatfs.s
	bsdsyscalls/_fstatfs64.s
	bsdsyscalls/_fstat.s
	bsdsyscalls/___fstat64_extended.s
	bsdsyscalls/_fstat64.s
	bsdsyscalls/___fsync_nocancel.s
	bsdsyscalls/_fsync.s
	bsdsyscalls/_ftruncate.s
	bsdsyscalls/_futimes.s
	bsdsyscalls/_getattrlistat.s
	bsdsyscalls/_getattrlistbulk.s
	bsdsyscalls/___getattrlist.s
	bsdsyscalls/_getaudit_addr.s
	bsdsyscalls/_getauid.s
	bsdsyscalls/_getdirentriesattr.s
	bsdsyscalls/_getdirentries.s
	bsdsyscalls/___getdirentries64.s
	bsdsyscalls/_getdtablesize.s
	bsdsyscalls/_getegid.s
	bsdsyscalls/_getentropy.s
	bsdsyscalls/_geteuid.s
	bsdsyscalls/_getfh.s
	bsdsyscalls/_getfsstat.s
	bsdsyscalls/_getfsstat64.s
	bsdsyscalls/_getgid.s
	bsdsyscalls/_getgroups.s
	bsdsyscalls/___gethostuuid.s
	bsdsyscalls/_getitimer.s
	bsdsyscalls/___getlogin.s
	bsdsyscalls/___getpeername.s
	bsdsyscalls/_getpgid.s
	bsdsyscalls/_getpgrp.s
	bsdsyscalls/___getpid.s
	bsdsyscalls/_getppid.s
	bsdsyscalls/_getpriority.s
	bsdsyscalls/___getrlimit.s
	bsdsyscalls/_getrusage.s
	bsdsyscalls/___getsgroups.s
	bsdsyscalls/_getsid.s
	bsdsyscalls/___getsockname.s
	bsdsyscalls/_getsockopt.s
	bsdsyscalls/___gettid.s
	bsdsyscalls/___gettimeofday.s
	bsdsyscalls/_getuid.s
	bsdsyscalls/___getwgroups.s
	bsdsyscalls/_getxattr.s
	bsdsyscalls/_grab_pgo_data.s
	bsdsyscalls/_guarded_close_np.s
	bsdsyscalls/_guarded_kqueue_np.s
	bsdsyscalls/___guarded_open_dprotected_np.s
	bsdsyscalls/___guarded_open_np.s
	bsdsyscalls/_guarded_pwrite_np.s
	bsdsyscalls/_guarded_write_np.s
	bsdsyscalls/_guarded_writev_np.s
	bsdsyscalls/_change_fdguard_np.s
	bsdsyscalls/_chdir.s
	bsdsyscalls/_chflags.s
	bsdsyscalls/___chmod_extended.s
	bsdsyscalls/___chmod.s
	bsdsyscalls/_chown.s
	bsdsyscalls/_chroot.s
	bsdsyscalls/___identitysvc.s
	bsdsyscalls/___initgroups.s
	bsdsyscalls/___ioctl.s
	bsdsyscalls/___iopolicysys.s
	bsdsyscalls/_issetugid.s
	bsdsyscalls/_kas_info.s
	bsdsyscalls/___kdebug_trace.s
	bsdsyscalls/___kdebug_trace_string.s
	bsdsyscalls/___kdebug_trace64.s
	bsdsyscalls/___kdebug_typefilter.s
	bsdsyscalls/_kevent_qos.s
	bsdsyscalls/_kevent.s
	bsdsyscalls/_kevent64.s
	bsdsyscalls/___kill.s
	bsdsyscalls/_kqueue.s
	bsdsyscalls/_ledger.s
	bsdsyscalls/___lchown.s
	bsdsyscalls/_linkat.s
	bsdsyscalls/_link.s
	bsdsyscalls/_lio_listio.s
	bsdsyscalls/___listen.s
	bsdsyscalls/_listxattr.s
	bsdsyscalls/___lseek.s
	bsdsyscalls/___lstat_extended.s
	bsdsyscalls/_lstat.s
	bsdsyscalls/___lstat64_extended.s
	bsdsyscalls/_lstat64.s
	bsdsyscalls/___mac_execve.s
	bsdsyscalls/___mac_get_fd.s
	bsdsyscalls/___mac_get_file.s
	bsdsyscalls/___mac_getfsstat.s
	bsdsyscalls/___mac_get_link.s
	bsdsyscalls/___mac_get_mount.s
	bsdsyscalls/___mac_get_pid.s
	bsdsyscalls/___mac_get_proc.s
	bsdsyscalls/___mac_mount.s
	bsdsyscalls/___mac_set_fd.s
	bsdsyscalls/___mac_set_file.s
	bsdsyscalls/___mac_set_link.s
	bsdsyscalls/___mac_set_proc.s
	bsdsyscalls/___mac_syscall.s
	bsdsyscalls/_madvise.s
	bsdsyscalls/_memorystatus_control.s
	bsdsyscalls/_memorystatus_get_level.s
	bsdsyscalls/___microstackshot.s
	bsdsyscalls/_mincore.s
	bsdsyscalls/_minherit.s
	bsdsyscalls/_mkdirat.s
	bsdsyscalls/___mkdir_extended.s
	bsdsyscalls/_mkdir.s
	bsdsyscalls/___mkfifo_extended.s
	bsdsyscalls/_mkfifo.s
	bsdsyscalls/_mknod.s
	bsdsyscalls/_mlockall.s
	bsdsyscalls/_mlock.s
	bsdsyscalls/___mmap.s
	bsdsyscalls/_modwatch.s
	bsdsyscalls/_mount.s
	bsdsyscalls/___mprotect.s
	bsdsyscalls/_mremap_encrypted.s
	bsdsyscalls/___msgctl.s
	bsdsyscalls/_msgget.s
	bsdsyscalls/___msgrcv_nocancel.s
	bsdsyscalls/_msgrcv.s
	bsdsyscalls/___msgsnd_nocancel.s
	bsdsyscalls/_msgsnd.s
	bsdsyscalls/___msgsys.s
	bsdsyscalls/___msync_nocancel.s
	bsdsyscalls/___msync.s
	bsdsyscalls/_munlockall.s
	bsdsyscalls/_munlock.s
	bsdsyscalls/___munmap.s
	bsdsyscalls/_necp_client_action.s
	bsdsyscalls/_necp_match_policy.s
	bsdsyscalls/_necp_open.s
	bsdsyscalls/_netagent_trigger.s
	bsdsyscalls/_nfsclnt.s
	bsdsyscalls/_nfssvc.s
	bsdsyscalls/_____old_semwait_signal_nocancel.s
	bsdsyscalls/___old_semwait_signal.s
	bsdsyscalls/___openat_nocancel.s
	bsdsyscalls/___openat.s
	bsdsyscalls/_openbyid_np.s
	bsdsyscalls/___open_dprotected_np.s
	bsdsyscalls/___open_extended.s
	bsdsyscalls/___open_nocancel.s
	bsdsyscalls/___open.s
	bsdsyscalls/_pathconf.s
	bsdsyscalls/_peeloff.s
	bsdsyscalls/___persona.s
	bsdsyscalls/_pid_resume.s
	bsdsyscalls/_pid_suspend.s
	bsdsyscalls/___pipe.s
	bsdsyscalls/___poll_nocancel.s
	bsdsyscalls/_poll.s
	bsdsyscalls/___posix_spawn.s
	bsdsyscalls/___pread_nocancel.s
	bsdsyscalls/_pread.s
	bsdsyscalls/___process_policy.s
	bsdsyscalls/___proc_info.s
	bsdsyscalls/_proc_rlimit_control.s
	bsdsyscalls/_proc_trace_log.s
	bsdsyscalls/_proc_uuid_policy.s
	bsdsyscalls/___pselect_nocancel.s
	bsdsyscalls/___pselect.s
	bsdsyscalls/___psynch_cvbroad.s
	bsdsyscalls/___psynch_cvclrprepost.s
	bsdsyscalls/___psynch_cvsignal.s
	bsdsyscalls/___psynch_cvwait.s
	bsdsyscalls/___psynch_mutexdrop.s
	bsdsyscalls/___psynch_mutexwait.s
	bsdsyscalls/___psynch_rw_downgrade.s
	bsdsyscalls/___psynch_rw_longrdlock.s
	bsdsyscalls/___psynch_rw_rdlock.s
	bsdsyscalls/___psynch_rw_unlock.s
	bsdsyscalls/___psynch_rw_unlock2.s
	bsdsyscalls/___psynch_rw_upgrade.s
	bsdsyscalls/___psynch_rw_wrlock.s
	bsdsyscalls/___psynch_rw_yieldwrlock.s
	bsdsyscalls/___pthread_canceled.s
	bsdsyscalls/___pthread_fchdir.s
	bsdsyscalls/___pthread_chdir.s
	bsdsyscalls/___pthread_kill.s
	bsdsyscalls/___pthread_markcancel.s
	bsdsyscalls/___pthread_sigmask.s
	bsdsyscalls/___ptrace.s
	bsdsyscalls/___pwrite_nocancel.s
	bsdsyscalls/_pwrite.s
	bsdsyscalls/_quotactl.s
	bsdsyscalls/_readlinkat.s
	bsdsyscalls/_readlink.s
	bsdsyscalls/___read_nocancel.s
	bsdsyscalls/_read.s
	bsdsyscalls/___readv_nocancel.s
	bsdsyscalls/_readv.s
	bsdsyscalls/_reboot.s
	bsdsyscalls/___recvfrom_nocancel.s
	bsdsyscalls/___recvfrom.s
	bsdsyscalls/___recvmsg_nocancel.s
	bsdsyscalls/___recvmsg.s
	bsdsyscalls/_recvmsg_x.s
	bsdsyscalls/_removexattr.s
	bsdsyscalls/___renameat.s
	bsdsyscalls/___renameatx_np.s
	bsdsyscalls/___rename.s
	bsdsyscalls/_revoke.s
	bsdsyscalls/___rmdir.s
	bsdsyscalls/_searchfs.s
	bsdsyscalls/___select_nocancel.s
	bsdsyscalls/___select.s
	bsdsyscalls/_sem_close.s
	bsdsyscalls/___semctl.s
	bsdsyscalls/_semget.s
	bsdsyscalls/___sem_open.s
	bsdsyscalls/_semop.s
	bsdsyscalls/_sem_post.s
	bsdsyscalls/___semsys.s
	bsdsyscalls/_sem_trywait.s
	bsdsyscalls/_sem_unlink.s
	bsdsyscalls/___sem_wait_nocancel.s
	bsdsyscalls/_sem_wait.s
	bsdsyscalls/___semwait_signal_nocancel.s
	bsdsyscalls/___semwait_signal.s
	bsdsyscalls/_sendfile.s
	bsdsyscalls/___sendmsg_nocancel.s
	bsdsyscalls/___sendmsg.s
	bsdsyscalls/_sendmsg_x.s
	bsdsyscalls/___sendto_nocancel.s
	bsdsyscalls/___sendto.s
	bsdsyscalls/___setattrlist.s
	bsdsyscalls/_setaudit_addr.s
	bsdsyscalls/_setauid.s
	bsdsyscalls/_setegid.s
	bsdsyscalls/_seteuid.s
	bsdsyscalls/_setgid.s
	bsdsyscalls/_setgroups.s
	bsdsyscalls/_setitimer.s
	bsdsyscalls/___setlogin.s
	bsdsyscalls/_setpgid.s
	bsdsyscalls/___setpriority.s
	bsdsyscalls/_setprivexec.s
	bsdsyscalls/___setregid.s
	bsdsyscalls/___setreuid.s
	bsdsyscalls/___setrlimit.s
	bsdsyscalls/___setsgroups.s
	bsdsyscalls/_setsid.s
	bsdsyscalls/_setsockopt.s
	bsdsyscalls/___settid.s
	bsdsyscalls/___settid_with_pid.s
	bsdsyscalls/___settimeofday.s
	bsdsyscalls/_setuid.s
	bsdsyscalls/___setwgroups.s
	bsdsyscalls/_setxattr.s
	bsdsyscalls/___sfi_ctl.s
	bsdsyscalls/___sfi_pidctl.s
	bsdsyscalls/___shared_region_check_np.s
	bsdsyscalls/___shared_region_map_and_slide_np.s
	bsdsyscalls/_shmat.s
	bsdsyscalls/___shmctl.s
	bsdsyscalls/_shmdt.s
	bsdsyscalls/_shmget.s
	bsdsyscalls/___shm_open.s
	bsdsyscalls/___shmsys.s
	bsdsyscalls/_shm_unlink.s
	bsdsyscalls/_shutdown.s
	bsdsyscalls/___sigaction.s
	bsdsyscalls/___sigaltstack.s
	bsdsyscalls/_sigpending.s
	bsdsyscalls/_sigprocmask.s
	bsdsyscalls/___sigreturn.s
	bsdsyscalls/___sigsuspend_nocancel.s
	bsdsyscalls/___sigsuspend.s
	bsdsyscalls/_____sigwait_nocancel.s
	bsdsyscalls/___sigwait.s
	bsdsyscalls/_socket_delegate.s
	bsdsyscalls/___socketpair.s
	bsdsyscalls/_socket.s
	bsdsyscalls/___stack_snapshot_with_config.s
	bsdsyscalls/___stat_extended.s
	bsdsyscalls/_statfs.s
	bsdsyscalls/_statfs64.s
	bsdsyscalls/_stat.s
	bsdsyscalls/___stat64_extended.s
	bsdsyscalls/_stat64.s
	bsdsyscalls/_swapon.s
	bsdsyscalls/_symlinkat.s
	bsdsyscalls/_symlink.s
	bsdsyscalls/_sync.s
	bsdsyscalls/___syscall.s
	bsdsyscalls/___sysctlbyname.s
	bsdsyscalls/___sysctl.s
	bsdsyscalls/_system_override.s
	bsdsyscalls/___telemetry.s
	bsdsyscalls/___terminate_with_payload.s
	bsdsyscalls/___thread_selfid.s
	bsdsyscalls/___thread_selfusage.s
	bsdsyscalls/_truncate.s
	bsdsyscalls/___ulock_wait.s
	bsdsyscalls/___ulock_wake.s
	bsdsyscalls/___umask_extended.s
	bsdsyscalls/_umask.s
	bsdsyscalls/_undelete.s
	bsdsyscalls/___unlinkat.s
	bsdsyscalls/___unlink.s
	bsdsyscalls/_unmount.s
	bsdsyscalls/_usrctl.s
	bsdsyscalls/_utimes.s
	bsdsyscalls/___vfork.s
	bsdsyscalls/_vfs_purge.s
	bsdsyscalls/_vm_pressure_monitor.s
	bsdsyscalls/_waitevent.s
	bsdsyscalls/___waitid_nocancel.s
	bsdsyscalls/_waitid.s
	bsdsyscalls/___wait4_nocancel.s
	bsdsyscalls/___wait4.s
	bsdsyscalls/_watchevent.s
	bsdsyscalls/___work_interval_ctl.s
	bsdsyscalls/___workq_kernreturn.s
	bsdsyscalls/___workq_open.s
	bsdsyscalls/___write_nocancel.s
	bsdsyscalls/_write.s
	bsdsyscalls/___writev_nocancel.s
	bsdsyscalls/_writev.s
	bsdsyscalls/___kqueue_workloop_ctl.s
	bsdsyscalls/___mach_bridge_remote_time.s
	bsdsyscalls/___reboot.s
	bsdsyscalls/_fmount.s
	bsdsyscalls/_kevent_id.s
	bsdsyscalls/_necp_session_action.s
	bsdsyscalls/_necp_session_open.s
	bsdsyscalls/_net_qos_guideline.s
	bsdsyscalls/_ntp_adjtime.s
	bsdsyscalls/_ntp_gettime.s
	bsdsyscalls/_os_fault_with_payload.s
	bsdsyscalls/_pid_hibernate.s
	bsdsyscalls/_pid_shutdown_sockets.s
	bsdsyscalls/_thread_selfcounts.s
)


mig(mach/clock.defs)
mig(mach/host_priv.defs)
mig(mach/host_security.defs)
mig(mach/ledger.defs)
mig(mach/lock_set.defs)
mig(mach/mach_host.defs)
mig(mach/mach_port.defs)
mig(mach/mach_vm.defs)
mig(mach/mach_voucher.defs)
mig(mach/notify.defs)
mig(mach/processor_set.defs)
mig(mach/processor.defs)
mig(mach/task.defs)
mig(mach/thread_act.defs)
mig(mach/vm_map.defs)

set_source_files_properties(${syscall_legacy_sources} PROPERTIES COMPILE_FLAGS "-U_DARWIN_C_SOURCE -U__DARWIN_UNIX03 -D__DARWIN_UNIX03=0 -U__DARWIN_C_LEVEL")
set_source_files_properties(wrappers/legacy/select-pre1050.c PROPERTIES COMPILE_FLAGS "-U_DARWIN_C_SOURCE -DSYSCALL_PRE1050")
set_source_files_properties(wrappers/cancelable/select-cancel.c PROPERTIES COMPILE_FLAGS "-U_DARWIN_C_SOURCE")
set_source_files_properties(wrappers/cancelable/select.c PROPERTIES COMPILE_FLAGS "-U_DARWIN_C_SOURCE")

foreach (file IN ITEMS ${syscall_legacy_sources})
	set_source_files_properties(${file} PROPERTIES COMPILE_FLAGS "${CMAKE_C_FLAGS} -U_DARWIN_C_SOURCE -U_POSIX_C_SOURCE -U__DARWIN_UNIX03 -D__DARWIN_UNIX03=0  -U__DARWIN_C_LEVEL")
endforeach(file)

add_darling_object_library(libsyscall ${syscall_sources})
add_darling_object_library(libsyscall_dynamic ${syscall_dynamic_sources})
make_fat(libsyscall)
make_fat(libsyscall_dynamic)

#add_darling_object_library(libsyscall_static wrappers/_libc_funcptr.c)
#set_target_properties(libsyscall_static PROPERTIES COMPILE_FLAGS "-DVARIANT_DYLD")
#make_fat(libsyscall_static)

# For i386
#add_darling_object_library(libsyscall_legacy_extra wrappers/legacy/select.c)
#set_target_properties(libsyscall_legacy_extra PROPERTIES COMPILE_FLAGS
#	"${CMAKE_C_FLAGS} -U_DARWIN_C_SOURCE -U_POSIX_C_SOURCE -U__DARWIN_UNIX03 -D__DARWIN_UNIX03=0 -U__DARWIN_C_LEVEL")



